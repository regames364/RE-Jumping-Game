<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>RE Jumping Game</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<style>
  body { margin: 0; background: black; }
</style>
</head>
<body>

<script>
/* ================= GLOBAL ================= */
let level = 0;
let lives = 3;
let chosenChar = 0;
let language = "en";
let canDoubleJump = false;
let dying = false;

const TEXT = {
  en: {
    title: "RE Jumping Game",
    start: "START GAME",
    instructions: "INSTRUCTIONS",
    language: "Language / Idioma",
    instTitle: "Instructions",
    instText: "1. WASD or Arrow Keys\n2. Press W or Up twice to double jump",
    back: "BACK",
    level: "Level"
  },
  es: {
    title: "RE Juego de Saltos",
    start: "INICIAR JUEGO",
    instructions: "INSTRUCCIONES",
    language: "Idioma / Language",
    instTitle: "Instrucciones",
    instText: "1. WASD o Flechas\n2. Presiona W o Arriba dos veces para doble salto",
    back: "VOLVER",
    level: "Nivel"
  }
};

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 500,
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  physics: {
    default: "arcade",
    arcade: { gravity: { y: 1000 } }
  },
  scene: [Menu, Instructions, LanguageScene, Game]
};

new Phaser.Game(config);

/* ================= MENU ================= */
function Menu(){ Phaser.Scene.call(this,{key:"Menu"});}
Menu.prototype = Object.create(Phaser.Scene.prototype);

Menu.prototype.preload=function(){
  this.load.image("dude","https://labs.phaser.io/assets/sprites/phaser-dude.png");
};

Menu.prototype.create=function(){
  const t = TEXT[language];

  this.add.text(400,60,t.title,{fontSize:"42px",fill:"#fff"}).setOrigin(0.5);

  this.addBtn(400,140,t.start,()=>this.scene.start("Game"));
  this.addBtn(400,190,t.instructions,()=>this.scene.start("Instructions"));
  this.addBtn(400,240,t.language,()=>this.scene.start("LanguageScene"));

  const colors=[0xff4444,0x44ff44,0x4444ff,0xffff00,0xff8800];
  colors.forEach((c,i)=>{
    const x=160+i*120,y=360;
    const box=this.add.rectangle(x,y,80,100,0x222222)
      .setStrokeStyle(3,0xffffff)
      .setInteractive();
    const dude=this.add.sprite(x,y+10,"dude").setScale(0.6).setTint(c);

    box.on("pointerdown",()=>{
      chosenChar=i;
      this.children.list.forEach(o=>{
        if(o.type==="Rectangle") o.setStrokeStyle(3,0xffffff);
      });
      box.setStrokeStyle(4,0xffff00);
    });
  });
};

Menu.prototype.addBtn=function(x,y,text,cb){
  return this.add.text(x,y,text,{
    fontSize:"20px",
    backgroundColor:"#3333aa",
    padding:{x:20,y:10}
  }).setOrigin(0.5).setInteractive().on("pointerdown",cb);
};

/* ================= INSTRUCTIONS ================= */
function Instructions(){ Phaser.Scene.call(this,{key:"Instructions"});}
Instructions.prototype = Object.create(Phaser.Scene.prototype);

Instructions.prototype.create=function(){
  const t = TEXT[language];
  this.add.text(400,100,t.instTitle,{fontSize:"42px",fill:"#fff"}).setOrigin(0.5);
  this.add.text(400,240,t.instText,{fontSize:"22px",fill:"#fff",align:"center"}).setOrigin(0.5);
  this.addBtn(400,420,t.back,()=>this.scene.start("Menu"));
};
Instructions.prototype.addBtn=Menu.prototype.addBtn;

/* ================= LANGUAGE ================= */
function LanguageScene(){ Phaser.Scene.call(this,{key:"LanguageScene"});}
LanguageScene.prototype = Object.create(Phaser.Scene.prototype);

LanguageScene.prototype.create=function(){
  this.add.text(400,100,"Language / Idioma",{fontSize:"42px",fill:"#fff"}).setOrigin(0.5);
  const en=this.addBtn(400,220,"English",()=>{language="en";this.scene.start("Menu");});
  const es=this.addBtn(400,280,"Español",()=>{language="es";this.scene.start("Menu");});
  (language==="en"?en:es).setStyle({stroke:"#ffff00",strokeThickness:4});
};
LanguageScene.prototype.addBtn=Menu.prototype.addBtn;

/* ================= GAME ================= */
function Game(){ Phaser.Scene.call(this,{key:"Game"});}
Game.prototype = Object.create(Phaser.Scene.prototype);

Game.prototype.preload=function(){
  this.load.image("dude","https://labs.phaser.io/assets/sprites/phaser-dude.png");
};

// ❤️ draw a heart shape
Game.prototype.drawHeart=function(x,y){
  const g=this.add.graphics({fillStyle:{color:0xff3333}});
  g.fillCircle(x-6,y,6);
  g.fillCircle(x+6,y,6);
  g.fillTriangle(x-12,y,x+12,y,x,y+14);
  return g;
};

Game.prototype.create=function(){
  const t=TEXT[language];
  dying=false;
  canDoubleJump=false;

  this.cursors=this.input.keyboard.createCursorKeys();
  this.physics.world.setBounds(0,-2000,800,2500);

  this.platforms=this.physics.add.staticGroup();

  this.platforms.create(400,450).setSize(320,24).refreshBody();

  for(let y=300;y>-1800;y-=200){
    this.platforms.create(
      Phaser.Math.Between(160,640),
      y
    ).setSize(260,22).refreshBody();
  }

  this.player=this.physics.add.sprite(400,410,"dude")
    .setTint([0xff4444,0x44ff44,0x4444ff,0xffff00,0xff8800][chosenChar])
    .setCollideWorldBounds(true);

  this.physics.add.collider(this.player,this.platforms,()=>{
    canDoubleJump=true;
  });

  // Lava
  this.lava=this.add.rectangle(400,520,900,80,0xff3300);
  this.physics.add.existing(this.lava,true);
  this.physics.add.overlap(this.player,this.lava,()=>this.hitLava());

  this.cameras.main.startFollow(this.player);

  // ===== HUD =====
  this.hud=this.add.container(10,10).setScrollFactor(0);
  this.hearts=[];
  for(let i=0;i<lives;i++){
    const heart=this.drawHeart(20+i*30,18);
    this.hud.add(heart);
    this.hearts.push(heart);
  }
  this.hud.add(this.add.text(0,40,`${t.level} ${level+1}`,{
    fontSize:"18px",fill:"#fff"
  }));
};

Game.prototype.hitLava=function(){
  if(dying) return;
  dying=true;
  lives--;
  if(lives<=0){
    lives=3;
    this.scene.start("Menu");
  } else {
    this.scene.restart();
  }
};

Game.prototype.update=function(){
  this.lava.y -= 0.6;

  if(this.cursors.left.isDown) this.player.setVelocityX(-220);
  else if(this.cursors.right.isDown) this.player.setVelocityX(220);
  else this.player.setVelocityX(0);

  if(Phaser.Input.Keyboard.JustDown(this.cursors.up)){
    if(this.player.body.blocked.down){
      this.player.setVelocityY(-600);
      canDoubleJump=true;
    } else if(canDoubleJump){
      this.player.setVelocityY(-760);
      canDoubleJump=false;
    }
  }
};
</script>
</body>
</html>
